<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Locum Optometry Shifts Map</title>
    <!-- Leaflet CSS with Integrity Hash for Ghost -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Leaflet JS with Integrity Hash for Ghost -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            /* Remove fixed height on body to allow scrolling if needed */
            height: auto;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f3f4f6;
        }

        /* Main container panel - FIXED HEIGHT FOR GHOST */
        #mainPanel {
            width: 100%;
            height: 850px;
            /* Taller fixed height for embed */
            position: relative;
            overflow: hidden;
            /* Keep map contained */
            border-radius: 8px;
            /* Slight rounding for embed */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Map container - takes full space */
        #mapContainer {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Floating Controls Card */
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Title in controls */
        .control-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        /* Styled Dropdown */
        #mode {
            width: 100%;
            padding: 10px 16px;
            font-size: 14px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #fff;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            outline: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23374151%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 12px top 50%;
            background-size: 10px auto;
        }

        #mode:hover {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        #mode:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        /* Status Text */
        #dataStatus {
            font-size: 12px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 8px 12px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        /* Ensure Leaflet controls don't overflow */
        .leaflet-container {
            overflow: hidden;
        }

        /* Move zoom controls to bottom right */
        .leaflet-top.leaflet-left {
            top: 20px;
            left: 20px;
        }
    </style>
</head>

<body>

    <div id="mainPanel">
        <div id="mapContainer">
            <div id="map"></div>
        </div>

        <div id="controls">
            <div class="control-title">Map Settings</div>
            <select id="mode">
                <option value="total">Total Pay</option>
                <option value="Density And Companies">Density And Companies</option>
                <option value="frequency">Repeat Booking Highlighter</option>
            </select>
            <div id="dataStatus">Loading map data...</div>
        </div>
    </div>

    <script>
        (function () {
            // Initialize the map
            let map;
            let markersLayer;

            const locationsData = [
  {
    "name": "Macclesfield",
    "lat": 53.2606635,
    "lon": -2.1255158,
    "shifts": [
      {
        "location": "Macclesfield",
        "total": 160.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Derbyshire",
    "lat": 53.1185033,
    "lon": -1.5566179,
    "shifts": [
      {
        "location": "Derbyshire",
        "total": 76.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Warrington",
    "lat": 53.4018582,
    "lon": -2.5680224,
    "shifts": [
      {
        "location": "Warrington",
        "total": 175.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Stockton Heath, Warrington",
    "lat": 53.3725455,
    "lon": -2.5744227,
    "shifts": [
      {
        "location": "Stockton Heath, Warrington",
        "total": 140.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Widnes",
    "lat": 53.3646888,
    "lon": -2.7283328,
    "shifts": [
      {
        "location": "Widnes",
        "total": 87.5,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Bury",
    "lat": 52.2460367,
    "lon": 0.7125173,
    "shifts": [
      {
        "location": "Bury",
        "total": 136.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Woolfall Heath Avenue",
    "lat": 53.4241452,
    "lon": -2.8520538,
    "shifts": [
      {
        "location": "Woolfall Heath Avenue",
        "total": 128.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Saint Helens",
    "lat": 51.7591718,
    "lon": -1.2104763,
    "shifts": [
      {
        "location": "Saint Helens",
        "total": 93.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Hyde",
    "lat": 53.4508687,
    "lon": -2.0782603,
    "shifts": [
      {
        "location": "Hyde",
        "total": 90.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Liverpool",
    "lat": 53.4071991,
    "lon": -2.99168,
    "shifts": [
      {
        "location": "Liverpool",
        "total": 270.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "High Lane",
    "lat": 53.3651108,
    "lon": -2.0696568,
    "shifts": [
      {
        "location": "High Lane",
        "total": 120.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  },
  {
    "name": "Mossley",
    "lat": 53.5130582,
    "lon": -2.0358291,
    "shifts": [
      {
        "location": "Mossley",
        "total": 90.0,
        "company": "Unknown Agency"
      }
    ],
    "count": 1,
    "companies": [
      "Unknown Agency"
    ]
  }
];
            const lastUpdate = "2025-12-26 18:44 UTC";


            function initMap() {
                // Create map centered on UK
                map = L.map('map', {
                    center: [54.5, -2.5],
                    zoom: 6,
                    zoomControl: true,
                    scrollWheelZoom: true
                });

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(map);

                // Create a layer group for markers
                markersLayer = L.layerGroup().addTo(map);

                // Load the embedded data
                loadEmbeddedData();
            }

            function loadEmbeddedData() {
                // Check if locationsData is defined (injected)
                if (typeof locationsData !== 'undefined' && locationsData.length > 0) {
                    updateMap(locationsData);
                    document.getElementById('dataStatus').textContent =
                        `Loaded ${locationsData.length} locations`;
                } else {
                    document.getElementById('dataStatus').textContent = 'No data found';
                }
            }

            function updateMap(locations) {
                markersLayer.clearLayers();
                const mode = document.getElementById('mode').value;

                if (mode === 'total') {
                    const colorMap = {
                        green: "0, 128, 0",
                        orange: "255, 165, 0",
                        red: "255, 0, 0"
                    };

                    for (const loc of locations) {
                        for (const shift of loc.shifts) {
                            const colorName = shift.total >= 400 ? "green" : shift.total >= 325 ? "orange" : "red";
                            const rgb = colorMap[colorName];
                            const markerDiameter = 30;

                            const gradientIcon = L.divIcon({
                                className: 'custom-gradient-icon',
                                html: `<div style="background: radial-gradient(circle, rgba(${rgb}, 1) 0%, rgba(${rgb}, 0) 50%); width: 100%; height: 100%; border-radius: 50%;"></div>`,
                                iconSize: [markerDiameter, markerDiameter],
                                iconAnchor: [markerDiameter / 2, markerDiameter / 2]
                            });

                            const marker = L.marker([loc.lat, loc.lon], {
                                icon: gradientIcon
                            }).bindPopup(`<b>${loc.name}</b><br>Total Pay: £${shift.total.toFixed(2)}<br>Company: ${shift.company}`);

                            markersLayer.addLayer(marker);
                        }
                    }
                } else if (mode === 'Density And Companies') {
                    for (const loc of locations) {
                        let markerColor = "#7F8C8D";
                        if (loc.companies.includes('Specsavers')) {
                            markerColor = "#006A4E";
                        } else if (loc.companies.includes('Boots Opticians')) {
                            markerColor = "#005EB8";
                        } else if (loc.companies.includes('Vision Express')) {
                            markerColor = "#6A0DAD";
                        } else if (loc.companies.includes('Asda')) {
                            markerColor = "#78BE20";
                        }

                        const svgIcon = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="marker">
          <path fill-opacity=".25" d="M16 32s1.427-9.585 3.761-12.025c4.595-4.805 8.685-.99 8.685-.99s4.044 3.964-.526 8.743C25.514 30.245 16 32 16 32z"/>
          <path fill="${markerColor}" stroke="#fff" d="M15.938 32S6 17.938 6 12C6 6.477 10.477 2 16 2s10 4.477 10 10c0 5.938-9.938 20-9.938 20zM16 16a4 4 0 110-8 4 4 0 010 8z"/>
        </svg>`;

                        const customIcon = L.divIcon({
                            html: svgIcon,
                            className: "",
                            iconSize: [22, 22],
                            iconAnchor: [13, 13],
                            popupAnchor: [0, -5]
                        });

                        const marker = L.marker([loc.lat, loc.lon], { icon: customIcon })
                            .bindPopup(`<b>${loc.name}</b><br>Companies: ${loc.companies.join(", ")}<br>Available Shifts: ${loc.count}`);

                        markersLayer.addLayer(marker);
                    }
                } else if (mode === 'frequency') {
                    for (const loc of locations) {
                        let color, radius, fillOpacity;

                        if (loc.count >= 3) {
                            color = "green";
                            radius = 8 + Math.log(loc.count);
                            fillOpacity = 0.5;
                        } else {
                            color = "White";
                            radius = 1;
                            fillOpacity = 0.1;
                        }

                        const marker = L.circleMarker([loc.lat, loc.lon], {
                            radius: radius,
                            color: color,
                            fillOpacity: fillOpacity
                        }).bindPopup(`<b>${loc.name}</b><br>Companies: ${loc.companies.join(", ")}<br>Available Shifts: ${loc.count}`);
                        markersLayer.addLayer(marker);
                    }
                }
            }

            // Event listener for mode changes
            document.getElementById('mode').addEventListener('change', function () {
                if (typeof locationsData !== 'undefined' && locationsData.length > 0) {
                    updateMap(locationsData);
                }
            });

            // Initialize map when page loads
            document.addEventListener('DOMContentLoaded', initMap);

            // Handle window resize
            window.addEventListener('resize', function () {
                if (map) {
                    map.invalidateSize();
                }
            });
        })();
    </script>

</body>

</html>